---
title: "Classifying vessel shapes"
subtitle: using automated shape extraction and unsupervised classification
author: "Martin Hinz^1^, Caroline Heitz^2^"
date: "March 2018"
institute: 1. Institute of Pre- and Protohistoric Archaeology, Kiel University; 2. Institut für Archäologische Wissenschaften, Bern University
fontsize: 9pt
output:
  beamer_presentation:
    theme: "metropolis"
    slide_level: 2
    fig_caption: yes
    toc: true
header-includes:
  - \titlegraphic{\begin{flushright}\includegraphics[width=.3\textwidth]{../images/logos/isaak_with_text.png}\end{flushright}\hfill}
  - \metroset{sectionpage=progressbar}
  - \def\begincols{\begin{columns}}
  - \def\begincol{\begin{column}}
  - \def\endcol{\end{column}}
  - \def\endcols{\end{columns}}
  - \usepackage{animate}
  - \usepackage{caption}
  - \captionsetup{font=scriptsize,labelfont=scriptsize}

---

```{r, echo = FALSE}
# https://stackoverflow.com/questions/25646333/code-chunk-font-size-in-rmarkdown-with-knitr-and-latex
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
```

# motivation

## shape vs. decoration for typology

## levels of pottery design

```{r table_shape_vs_decoration, echo=FALSE}
tabl <- c(
  "functional dependency", "strong","weak",
  "dependency on local ressources", "stronger","weak",
  "moment of determination", "from the beginning","finished product",
  "ad hoc changes", "difficult","easy",
  "more reflecting", "habitus", "personal signature",
  "design decision", "more collective", "more individual",
  "homogenity", "more convergent", "more divergent",
  "degrees of freedom", "lesser", "more",
  "category of style", "more isochrestic", "more emblemic",
  "unit of analysis", "ideal type", "singularity"
)

tabl <- matrix(tabl,ncol=3, byrow = T)
colnames(tabl) <- c("criteria", "shape", "decoration")
knitr::kable(tabl)
```

## Phases of ceramic production

### Design
* imagined and intended
* concept of a shape
* ideal type
* **social bounded options for creativity**

### 'style of action'
* learned, habitual movements, manipulations, routines
* at all stages of the *chaîne opératoire*
* instantiation
* **limited options for creativity**

### 'material style'
* physical traces and effects in the material
* Characteristics of the vessel
* finished object
* **material induced alterations of the original design possible**

## resume

### using vessel shapes to identify underlying large scaled 'communities of practice'
* more related to covert communication structures, habitus and similar (economic) practises
* 'better measurable' from a practical quantitative perspective

# previous approaches
Without claim to completeness:

## quantitative approaches towards shape-based typology

### using specific locations

* Koch 1998

### 'Hollistic' approaches

* Mom 2005
* Chapman et al., 2006
* Keogh et al., 2009

# Shape Extraction

## 'by hand'

### Workflow
![](../images/shape_simplification_before.png){ height=30% }

&downarrow;

![](../images/shape_simplification_after.png){ height=30% }

## Adaptive Contour Motivation

\begincols
\begincol{.48\textwidth}

* Scanned vessel drawings might have holes (dashed lines)
* No simple image segmentation with background color and floodfill possible

\endcol
\begincol{.48\textwidth}
```{r echo=FALSE, out.width='100%', fig.cap='Bell Beaker (Harrison 1977)'}
knitr::include_graphics('../images/harrison_1977_1727.png')
```
\endcol
\endcols


## Adaptive Contour: what is it

\begincols
\begincol{.48\textwidth}

> **Active contour model**, also called **snakes**, is a framework in computer vision for delineating an object outline from a possibly noisy 2D image.
> The snakes model is popular in computer vision, and snakes are greatly used in applications like object tracking, **shape recognition**, segmentation, edge detection and stereo matching.
> [Wikipedia](https://en.wikipedia.org/wiki/Active_contour_model)

\endcol
\begincol{.48\textwidth}

\animategraphics[loop,autoplay,width=\linewidth]{50}{../images/animation/morph_snake-}{0}{129}

\scriptsize{source: https://github.com/pmneila/morphsnakes}

\endcol
\endcols

## Active contour with Bell Beakers

See shapAAR vignette

\scriptsize{https://github.com/ISAAKiel/shapAAR/blob/master/vignettes/object-extraction.md}

```{r table_active_contour_workflow, echo=FALSE}
tabl <- c(
  "![Preparation](../images/shapaar_extraction/image_stopping_fun-1.png){ height=10% }", "Image preparation","bw, blur",
  "![Preparation](../images/shapaar_extraction/active_contor_result_compare-1.png){ height=10% }", "Image segmentation", "active_contour",
  "![Preparation](../images/shapaar_extraction/active_contor_object_selection-1.png){ height=10% }", "Selecting the biggest object","EBImage",
  "![Preparation](../images/shapaar_extraction/active_contor_object_rim_crop-2.png){ height=10% }", "Rectify and crop","get Bounding box, rotate upright, crop",
  "![Preparation](../images/shapaar_extraction/profile_contour_mean-2.png){ height=10% }", "half and side mean", "split in middle, mean left-right"
)

tabl <- matrix(tabl,ncol=3, byrow = T)
knitr::kable(tabl)
```

# Shape Analysis 1: PCA & hclust

## approach/workflow {.build}

* using profile distances + additional nominal variables as input
* conduct PCA
* using hclust (euclidean/Ward) to cluster
* package `FactoMinR`: HCPC with automatical cut (number of clusters according to higher relative loss of inertia)
* for individual clusters, repeat with cluster members as new dataset (usually 3 levels)

![](../images/hcpc_scatterplot.png){ height=25% } ![](../images/hcpc_3d_scatterplot.png){ height=25% } ![](../images/hcpc_tree.png){ height=25% }

## problems

* non-metric (non-euclidean) variables not considered correctly
* all vessels had to belong to one cluster (hand made ceramics)
* global dissimilarity resulted in suboptimal separation

# Shape Analysis 2: t-sne & hdbscan

## t-sne

### t-Distributed Stochastic Neighbor Embedding

\begincols
\begincol{.48\textwidth}
```{r echo=FALSE, out.width='100%', fig.cap='van der Maaten 2008; 2009; 2012; 2014; https://lvdmaaten.github.io/tsne/ https://www.youtube.com/watch?v=RJVL80Gg3lA'}
knitr::include_graphics('../images/tsne_swiss_roll.png')
```

\endcol
\begincol{.48\textwidth}

Challenge

* high dimensional non-linear data distribution
* consider not the global, but the local neighbourhood (contrasting PCA)

\endcol
\endcols

## hdbscan


### Hierarchical Density-Based Spatial Clustering of Applications with Noise



\begincols
\begincol{.48\textwidth}

![](../images/hdbscan_tree.png)

\endcol
\begincol{.48\textwidth}

Benefits:

* separating non-circular clusters
* 'identification' and exclusion of noise (hand made ceramics!)

\endcol
\endcols

![](../images/hdbscan_density.png){ height=25% } ![](../images/hdbscan_border.png){ height=25% } ![](../images/hdbscan_clusters.png){ height=25% }

## approach/workflow

* using profile distances + additional nominal variables as input
* conduct t-sne
* using hdbscan to cluster
* package `Rtsne`: conduct t-sne 
  * `Rtsne(as.matrix(shapes),perplexity=30,dims=2,theta = 0)`
* package `dbscan`: conduct hdbscan on t-sne result
  * `hdbscan(this_res_sne, minPts = 5)`
* for individual clusters, repeat with cluster members as new dataset (usually only 2 levels)

![](../images/tsne_hdbscan_level0.png){ height=25% } ![](../images/tsne_hdbscan_level1.png){ height=25% }

# Case studies

## Bell Beakers of the Iberian Peninsula

## Neolithic Swiss Ceramic

## Thank you
![Martin](../images/martin.png){ width=33px }
**Martin Hinz**              
martin.hinz@ufg.uni-kiel.de

![Caroline](../images/CarolineHeitz.jpg){ width=33px }
**Caroline Heitz**                   
caroline.heitz@iaw.unibe.ch  

